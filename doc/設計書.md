# 設計書: notice-reddit-post

## **概要**
Redditから投稿データを取得し、加工後に通知（DiscordやTwitter）を行うシンプルなシステム。

---

## **機能要件**

### **1. Redditデータの取得**
- 指定したサブレディットからトレンドの投稿を取得。
- コメントの階層を指定可能。

### **2. 投稿データの加工**
- 投稿データをLLM（大規模言語モデル）に送信し、要約を生成。
- 必要に応じてコメントを付与。

### **3. 通知**
- Discord: Webhookを用いて通知。
- Twitter: APIを用いてツイート。
- 設定に応じて通知先を切り替え可能。

### **4. コンフィグ管理**
- `config.toml` で設定を管理。
- 以下の項目を設定可能:
  - Redditの対象サブレディット、取得件数、コメント階層。
  - LLMのプロバイダーとモデル設定。
  - 通知先（Discord/Twitter）のAPI情報。

---

## **非機能要件**
- **軽量性**: データ保存を行わないシンプルな設計。
- **可読性**: TOML形式の設定ファイルで柔軟に管理。
- **柔軟性**: プロバイダーごとに複数のLLMをサポートし、切り替え可能。

---

## **技術スタック**
- **言語**: TypeScript
- **通知API**:
  - Discord Webhook
  - Twitter API
- **データ取得**: Reddit API
- **LLM**: OpenAI GPT-4 他（プロバイダー切り替え可能）
- **設定管理**: TOML

---

## **処理フロー**

1. **Redditデータ取得**:
   - Reddit APIから指定したサブレディットのトップ投稿を取得。
   - コメントを指定の深さで取得。

2. **データ加工**:
   - LLMに投稿データを送信して要約を生成。
   - コメントを適切に追加。

3. **通知送信**:
   - DiscordのWebhookまたはTwitter APIを使用して加工済みデータを送信。
   - 通知先は`config.toml`で柔軟に設定可能。

---

## **コード構成**

```
project-root/
├── src/
│   ├── index.ts         # メインエントリポイント
│   ├── reddit.ts        # Reddit API関連処理
│   ├── llm.ts           # LLM要約処理
│   ├── notify.ts        # 通知処理
│   └── config.ts        # 設定ファイル読み込み
├── config.toml    # 設定ファイル
└── package.json    # npmパッケージマネージャ設定
```

---

## **コード例: データ取得と通知処理**

### **Redditデータ取得例**
```typescript
import axios from "axios";

export async function fetchRedditPosts(subreddit: string, limit: number, depth: number) {
  const url = `https://www.reddit.com/r/${subreddit}/top.json?t=day&limit=${limit}`;
  const response = await axios.get(url, { headers: { "User-Agent": "RedditNotifier/1.0" } });
  const posts = response.data.data.children;

  for (const post of posts) {
    const postId = post.data.id;
    const commentsUrl = `https://www.reddit.com/r/${subreddit}/comments/${postId}.json?depth=${depth}`;
    const commentsResponse = await axios.get(commentsUrl, { headers: { "User-Agent": "RedditNotifier/1.0" } });
    post.comments = commentsResponse.data[1].data.children.map((comment: any) => comment.data.body);
  }

  return posts;
}
```

### **通知処理例**
```typescript
import axios from "axios";

export async function sendDiscordNotification(webhookUrl: string, content: string) {
  await axios.post(webhookUrl, { content });
}
```

---

## **開発のポイント**

1. **シンプルな構成**:
   - データ保存を行わず、即時処理して通知。
   - Firebaseや外部ストレージのセットアップを省略。

2. **柔軟な設定管理**:
   - TOML形式で全ての設定を一元化。

3. **モジュール化**:
   - API取得、要約、通知を独立したモジュールとして構築。

---

## **今後の拡張案**
- **ストレージ追加**: 必要に応じてFirebaseなどを導入し、履歴保存を実現。
- **新しい通知プラットフォーム**: SlackやLINEなどへの通知をサポート。
- **再送信機能**: 過去データの再通知を可能に。

---

## **結論**
`notice-reddit-post`は、シンプルな設計で即時的にRedditデータを通知する効率的なツールです。データ保存の省略によりセットアップが容易で、個人利用に最適化されています。

